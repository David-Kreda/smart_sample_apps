<!DOCTYPE html>
<html>
  <head>
    <title>Filler</title>
  </head>
  <body>

  <h1 style="font-family: Arial, sans-serif;">Filler</h1>
  You should see some alerts...
  
	
	<script  src='framework/smart/scripts/smart-api-client.js'></script>
	<script>
		SMART = new SMART_CLIENT(null, window.top);
		
		SMART.send_ready_message(function(record_info) {	
			SMART.MEDS_get_all(function(data) {
			
		
                data.prefix("med","http://smartplatforms.org/medication#");

                var meds = data.where("?med rdf:type sp:medication")
                .where("?med dcterms:title ?medname")
                .optional("?med med:instructions ?sig");

                var fills = {};
                for (var i = 0; i < meds.length; i++) {
							fills[nodename] = [];
                                    var med = meds[i];
                                    var sig = "";
                                    sig = med.sig? med.sig.value : " [no instructions ]";
				    
                                    //alert("You should take "+ med.medname.value+" "  +  sig);
                                    var drugs = new Object();
                                    drugs.name = med.medname.value;
                                    drugs.sig = sig;
				    
                                    var nodename = "<"+med.med.value+">";
                                    var cnt = 0;
                                    var fulfillments = data
                                    .where(nodename+" <http://smartplatforms.org/fulfillment> ?fill")
                                    .where("?fill ?f_field ?f_detail");

                                    for (var j = 0; j < fulfillments.length; j++) {
							alert("A fill value for " + nodename + " -- " + fulfillments[j].f_field.value + " : "  +fulfillments[j].f_detail.value);
                                   }
							
		}
	        alert("For " + meds.length + " meds we found " + fills);
		});
		});
		
		
	</script>
  </body>
</html>
