<!DOCTYPE html>
<html>
  <head>
    <title>Cardiology Risk Visualization</title>
      <script src='../smart/scripts/smart-api-page.js'></script>
      <script src='../jquery/jquery.js'></script>
      <script src='./raphael-min.js'></script>
      <script src='./g.raphael.js'></script>
      <script>
        // load data:
        // export PYTHONPATH=/home/smart/smart_server; export DJANGO_SETTINGS_MODULE=settings
        // cd load_tools; python load_one_patient.py /home/smart/smart_sample_apps/static/framework/cardio_risk_viz/3001.xml
        //
        // Docs:
        // LAB_RESULTS_get: http://wiki.chip.org/smart-project/index.php/Developers_Documentation:_RDF_Data#Lab_Result_RDF

        var reynolds_risks_score = function(p){
          // Women (not recommended for diabetics see http://www.reynoldsriskscore.org/faq.aspx)
          //
          // 10 year cardiovascular disease risk for women = 1-0.98634^(exp [B-22.325]) x 100%
          //
          // where B = 0.0799 x age 
          //         + 3.137 x ln(systolic bp)
          //         + 0.180 x ln(hsCRP)
          //         + 1.382 x ln(total cholesterol)
          //         - 1.172 x ln(HDL)
          //         + 0.134 x hba1c (%)  // if diabetic
          //         + 0.818              // if current smoker
          //         + 0.438              // if fx of premature myocardial infarction
          //
          // Men
          //
          // http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2752381/
          // 10 year cardiovascular disease risk for men = 1-0.8990^(exp [B-33.097]) x 100%
          //
          // where B = 4.385 x ln(age)
          //         + 2.607 x ln(systolic bp)
          //         + 0.102 x ln(hsCRP)
          //         + 0.963 x ln(total cholesterol)
          //         - 0.772 x ln(HDL)
          //         + 0.405              // if current smoker
          //         + 0.541              // if fx of premature myocardial infarction
          //
          // ** no hba1c! non-diabetic men
            
          var parameters = {}
            , result = null;

          if (p.gender.value === 'female') {
            params = {
              'age': 0.0799,
              'sbp': 3.137,
              'hsCRP': 0.180,
              'cholesterol': 1.382,
              'HDL': -1.172,
              'smoker': 0.818,
              'fx_of_mi': 0.438
            }
          } else {
            params = {
              'age': 4.385,
              'sbp': 2.607,
              'hsCRP': 0.102,
              'cholesterol': 0.963,
              'HDL': -0.772,
              'smoker': 0.405,
              'fx_of_mi': 0.541
            }
          }

          
          var b1 = params.age          * (p.gender.value==='female' ? p.age.value : Math.log(p.age.value))
            , b2 = params.sbp          * Math.log(p.sbp.value)
            , b3 = params.hsCRP        * Math.log(p.hsCRP.value)
            , b4 = params.cholesterol  * Math.log(p.cholesterol.value)
            , b5 = params.HDL          * Math.log(p.HDL.value)
            , b6 = params.smoker       * (p.smoker_p.value ? 1 : 0)
            , b7 = params.fx_of_mi     * (p.fx_of_mi_p.value ? 1 : 0);

          var B = b1 + b2 + b3 + b4 + b5 + b6 + b7;

          if (p.gender.value === 'female') {
            var a = Math.exp(B-22.325)
              , b = Math.pow(0.98634, a)
              , c = 1 - b
              , d = c * 100
              , result = (1 - Math.pow(0.98634, (Math.exp(B-22.325)))) * 100
          } else {

            var a = Math.exp(B-33.097)
              , b = Math.pow(0.8990, a)
              , c = 1 - b
              , d = c * 100
              , sresult = (1 - Math.pow(0.8990,  (Math.exp(B-33.097)))) * 100            
          }
          // console.log('RRS %', result, 'check with d', d, 'B', B);
          return result;
        }

        SMART.DEMOGRAPHICS_get(function(demographics) {
          var p = demographics
            .prefix('foaf', 'http://xmlns.com/foaf/0.1/')
            .prefix('sp', 'http://smartplatforms.org/terms#')
            .where('?a foaf:givenName ?givenName')
            .where('?a foaf:familyName ?familyName')
            .where('?a foaf:gender ?gender')
            .where('?a sp:birthday ?birthday')
            .get(0);

          var get_age = function(dob_string){
            var dob = new Date(dob_string);
            var today = new Date();
            var db = new Date(dob_string);
            var cy = today.getFullYear();
            var by = dob.getFullYear();
            db.setFullYear(cy);
            var adj = (today-db<0) ? 1 : 0;
            return cy - by - adj;
          }
          p.age = {'value': get_age(p.birthday.value)};

          SMART.LAB_RESULTS_get(function(labs){
            p.hsCRP = {
              'value': Number(labs.where("?l rdf:type sp:LabResult")
                                  .where("?l sp:labName ?ln")
                                  .where("?ln sp:code <http://loinc.org/codes/30522-7>")
                                  .where("?l sp:quantitativeResult ?qr") // predicate
                                  .where("?qr rdf:type sp:QuantitativeResult") // type
                                  .where("?qr sp:valueAndUnit ?vu")
                                  .where("?vu sp:value ?v")
                                  .get(0)
                                  .v
                                  .value)
            }

            p.cholesterol = {
              'value': Number(labs.where("?l rdf:type sp:LabResult")
                                  .where("?l sp:labName ?ln")
                                  .where("?ln sp:code <http://loinc.org/codes/2093-3>")
                                  .where("?l sp:quantitativeResult ?qr") // predicate
                                  .where("?qr rdf:type sp:QuantitativeResult") // type
                                  .where("?qr sp:valueAndUnit ?vu")
                                  .where("?vu sp:value ?v")
                                  .get(0)
                                  .v
                                  .value)
            }

            p.LDL = {
              'value': Number(labs.where("?l rdf:type sp:LabResult")
                                  .where("?l sp:labName ?ln")
                                  .where("?ln sp:code <http://loinc.org/codes/2089-1>")
                                  .where("?l sp:quantitativeResult ?qr") // predicate
                                  .where("?qr rdf:type sp:QuantitativeResult") // type
                                  .where("?qr sp:valueAndUnit ?vu")
                                  .where("?vu sp:value ?v")
                                  .get(0)
                                  .v
                                  .value)
            }

            p.HDL = {
              'value': Number(labs.where("?l rdf:type sp:LabResult")
                                  .where("?l sp:labName ?ln")
                                  .where("?ln sp:code <http://loinc.org/codes/2085-9>")
                                  .where("?l sp:quantitativeResult ?qr") // predicate
                                  .where("?qr rdf:type sp:QuantitativeResult") // type
                                  .where("?qr sp:valueAndUnit ?vu")
                                  .where("?vu sp:value ?v")
                                  .get(0)
                                  .v
                                  .value)
            }


            // fixtures until form input
            p.sbp = {'value': 130}
            p.smoker_p = {'value': true}
            p.fx_of_mi_p = {'value': true}
            
            // update data to test score against reference
            // p.givenName.value = 'John';
            // p.familyName.value = 'Doe';
            // p.age.value = 49;
            // p.gender.value = 'male';
            // , p.hsCRP = {'value': 3.3}
            // , p.cholesterol = {'value': 265}
            // , p.LDL = {'value': 233}
            // , p.HDL = {'value': 32}
            
            var score = reynolds_risks_score(p);
            var r = Raphael('holder');

            // set default txtattrs
            r.g.txtattr = {
              'font-family': 'Calibri, \'Helvetica Neue\', Helvetica, Verdana, sans-serif', 
              'font-size': '16px',
              'text-anchor': 'start',
              'fill': '#555'
            };

            // set up overall layout and text
            // using a 8 column grid on 800px
            r.g.text(10, 20, 'Bloodwork Cardiology Result').attr({'font-size': '24px'})
            r.path("M10 40 L290 40").attr({'stroke-dasharray': '.', 'stroke-linecap': 'butt'})        

            // pad in 40px
            r.g.text(40, 55, 'Patient info').attr({'font-size': '18px', 'font-weight': 'bold'})

            r.g.text(40, 80+3, 'NAME:').attr({'fill': '#888', 'font-size': '12px', 'font-weight': '200'});
            r.g.text(80, 80, p.givenName.value + ' ' + p.familyName.value).attr({'font-size': '24px', 'font-weight': 'normal'})
            
            r.g.text(40, 100+3, 'GENDER:').attr({'fill': '#888', 'font-size': '12px', 'font-weight': '200'});
            r.g.text(92, 100+2, p.gender.value == 'female' ? 'F' : 'M')
            
            r.g.text(112, 100+3, 'AGE:').attr({'fill': '#888', 'font-size': '12px', 'font-weight': '200'});
            r.g.text(142-1, 100, p.age.value)
            
            r.g.text(172, 100+3, 'DOB:').attr({'fill': '#888', 'font-size': '12px', 'font-weight': '200'});
            r.g.text(202-1, 100, p.birthday.value)

            r.path("M10 120 L790 120").attr({'stroke-dasharray': '.', 'stroke-linecap': 'butt'})        

            var y = 150;
            r.circle(40, y, 14).attr({'fill': '#F4804E', 'stroke': 'none'});
            r.g.text(40, y, '1').attr({'font': '18px Consolas', 'text-anchor': 'middle', 'font-weight': 'bold', 'fill': '#fff'})
            r.g.text(60, y, 'About this test').attr({'font-size': '18px', 'font-weight': 'bold'})
            r.g.text(60, y+20, 'This report evaluates your potential risk of heart disease, heart attack, and stroke.').attr({'fill': '#888'})
              .attr({'font-size': '14px'})
            
            r.path("M10 190 L790 190").attr({'stroke-dasharray': '.', 'stroke-linecap': 'butt'});

            y = 210;
            r.circle(40, y, 14).attr({'fill': '#F4804E', 'stroke': 'none'});
            r.g.text(40, y, '2').attr({'font': '18px Consolas', 'text-anchor': 'middle', 'font-weight': 'bold', 'fill': '#fff'})
            r.g.text(60, y, 'Your Results').attr({'font-size': '18px', 'font-weight': 'bold'})



            var title = 'CRP level test'
              , x = 60
              , y = 255
              , w = 700
              , h = 65
              , units_n = 10
              , unit_w = w / units_n
              , space = 2
              , cap_x = w + x
              , cap_y = y
              , cap_mid_x = 780
              , cap_mid_y = y + h/2
              , cap_end_x = cap_x
              , cap_end_y = y + h
            
            // make width smaller with space, start x on unit_w multiple 
            r.g.text(x, y-12, title).attr({'font-size': '18px', 'font-weight': 'normal'})

            r.rect(x+0,         y, unit_w-space,       h).attr({fill: '#61AFC9', stroke: 'none'});
            r.g.text(x, y+h+8, 'Low risk').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x, y+h+20, '0 mg/L').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.rect(x+unit_w,    y, unit_w*2-space,     h).attr({fill: '#0B9DBC', stroke: 'none'});
            r.g.text(x+unit_w,  y+h+8, 'Average').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w,  y+h+20, '1 - 3').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            // no -space here since the cap is next
            r.rect(x+unit_w*3,  y, unit_w*7,           h).attr({fill: '#008EB0', stroke: 'none'});
            r.g.text(x+unit_w*3, y+h+8, 'High risk of cardiovascular disease').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w*3, y+h+20, '3 - 10').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.path('M' + cap_x     + ' ' + cap_y + 
                   'L' + cap_mid_x + ' ' + cap_mid_y + 
                   'L' + cap_end_x + ' ' + cap_end_y +
                   'z')
                   .attr({'fill': '#008EB0', 'stroke': 'none'});

            // place circle on bar
            var circle_x = unit_w * p.hsCRP.value + x;
            r.circle(circle_x, y, 22).attr({'fill': '#F4804E', 'stroke': '#fff', 'stroke-width': '2px'});
            r.g.text(circle_x, y, p.hsCRP.value.toPrecision(2)).attr({'font': '20px Consolas', 'text-anchor': 'middle', 'font-weight': 'normal', 'fill': '#fff'})



            // mildly non-proportional to make things look nicer
            var title = 'Total cholesterol level'
              , x = 60
              , y = 380
              , w = 700
              , h = 65
              , units_n = 30 // max value 300
              , unit_w = w / units_n
              , space = 2
              , cap_x = w + x
              , cap_y = y
              , cap_mid_x = 780
              , cap_mid_y = y + h/2
              , cap_end_x = cap_x
              , cap_end_y = y + h
            
            r.g.text(x, y-12, title).attr({'font-size': '14px'})

            r.rect(x+0,         y, unit_w*18-space,       h).attr({fill: '#A0BE78', stroke: 'none'});
            r.g.text(x, y+h+8, 'Desirable').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x, y+h+20, '0 mg/dL').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.rect(x+unit_w*18,    y, unit_w*4-space,     h).attr({fill: '#86AD52', stroke: 'none'});
            r.g.text(x+unit_w*18,  y+h+8, 'Borderline').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w*18,  y+h+20, '200 - 239').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.rect(x+unit_w*22,  y, unit_w*8,           h).attr({fill: '#5E892B', stroke: 'none'});
            r.g.text(x+unit_w*22, y+h+8, 'High').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w*22, y+h+20, '240+').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.path('M' + cap_x     + ' ' + cap_y + 
                   'L' + cap_mid_x + ' ' + cap_mid_y + 
                   'L' + cap_end_x + ' ' + cap_end_y +
                   'z')
                   .attr({'fill': '#5E892B', 'stroke': 'none'});

            var circle_x = (unit_w * (p.cholesterol.value / 10)) + x;
            r.circle(circle_x, y, 22).attr({'fill': '#F4804E', 'stroke': '#fff', 'stroke-width': '2px'});
            r.g.text(circle_x, y, p.cholesterol.value).attr({'font': '20px Consolas', 'text-anchor': 'middle', 'font-weight': 'normal', 'fill': '#fff'})



            var title = 'LDL "bad" cholesterol'
              , x = 160
              , y = 500 // 130px from above
              , w = 600
              , h = 30
              , units_n = 30 // max value 300
              , unit_w = w / units_n
              , space = 2
              , cap_x = w + x
              , cap_y = y
              , cap_mid_x = 780 - 10 // adjust
              , cap_mid_y = y + h/2
              , cap_end_x = cap_x
              , cap_end_y = y + h
            
            r.g.text(x, y-12, title).attr({'font-size': '14px'})

            r.rect(x+0,         y, unit_w*10-space,       h).attr({fill: '#DCE6CC', stroke: 'none'});
            r.g.text(x, y+h+8, 'Optimal').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x, y+h+20, '0 mg/dL').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.rect(x+unit_w*10,    y, unit_w*3-space,     h).attr({fill: '#BDD1A0', stroke: 'none'});
            // adjust height for newline in text string
            r.g.text(x+unit_w*10,  y+h+15, 'Near\nOptimal').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w*10,  y+h+35, '100 - 129').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.rect(x+unit_w*13,  y, unit_w*3-space,           h).attr({fill: '#A0BE78', stroke: 'none'});
            r.g.text(x+unit_w*13, y+h+15, 'Borderline\nhigh').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w*13, y+h+35, '129 - 159').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.rect(x+unit_w*16,  y, unit_w*3-space,           h).attr({fill: '#86AD52', stroke: 'none'});
            r.g.text(x+unit_w*16, y+h+8, 'High').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w*16, y+h+20, '160 - 189').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.rect(x+unit_w*19,  y, unit_w*11,           h).attr({fill: '#5E892B', stroke: 'none'});
            r.g.text(x+unit_w*19, y+h+8, 'Very High').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w*19, y+h+20, '190+').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.path('M' + cap_x     + ' ' + cap_y + 
                   'L' + cap_mid_x + ' ' + cap_mid_y + 
                   'L' + cap_end_x + ' ' + cap_end_y +
                   'z')
                   .attr({'fill': '#5E892B', 'stroke': 'none'});

            var circle_x = (unit_w * (p.LDL.value / 10)) + x;
            r.circle(circle_x, y, 18).attr({'fill': '#F4804E', 'stroke': '#fff', 'stroke-width': '2px'});
            r.g.text(circle_x, y, p.LDL.value).attr({'font': '16px Consolas', 'text-anchor': 'middle', 'font-weight': 'normal', 'fill': '#fff'})



            var title = 'HDL "good" cholesterol'
              , x = 160
              , y = 620 // 120px from above
              , w = 600
              , h = 30
              , units_n = 10 // max value 100
              , unit_w = w / units_n
              , space = 2
              , cap_x = w + x
              , cap_y = y
              , cap_mid_x = 780 - 10 // adjust
              , cap_mid_y = y + h/2
              , cap_end_x = cap_x
              , cap_end_y = y + h
            
            r.g.text(x, y-12, title).attr({'font-size': '16px'})

            r.rect(x+0,         y, unit_w*4-space,       h).attr({fill: '#A0BE78', stroke: 'none'});
            r.g.text(x, y+h+8, 'Low').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x, y+h+20, '0 mg/dL').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.rect(x+unit_w*4,    y, unit_w*2-space,     h).attr({fill: '#86AD52', stroke: 'none'});
            r.g.text(x+unit_w*4,  y+h+8, 'Normal').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w*4,  y+h+20, '100 - 129').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.rect(x+unit_w*6,  y, unit_w*4,           h).attr({fill: '#5E892B', stroke: 'none'});
            r.g.text(x+unit_w*6, y+h+8, 'High').attr({'font-size': '12px', 'font-weight': 'normal'})
            r.g.text(x+unit_w*6, y+h+20, '129 - 159').attr({'font-size': '10px', 'font-weight': '200', 'fill': '#888'})

            r.path('M' + cap_x     + ' ' + cap_y + 
                   'L' + cap_mid_x + ' ' + cap_mid_y + 
                   'L' + cap_end_x + ' ' + cap_end_y +
                   'z')
                   .attr({'fill': '#5E892B', 'stroke': 'none'});

            var circle_x = (unit_w * (p.HDL.value / 10)) + x;
            r.circle(circle_x, y, 18).attr({'fill': '#F4804E', 'stroke': '#fff', 'stroke-width': '2px'});
            r.g.text(circle_x, y, p.HDL.value).attr({'font': '16px Consolas', 'text-anchor': 'middle', 'font-weight': 'normal', 'fill': '#fff'})


            r.path("M10 700 L790 700").attr({'stroke-dasharray': '.', 'stroke-linecap': 'butt'})        
            r.circle(40, 720, 14).attr({'fill': '#F4804E', 'stroke': 'none'});
            r.g.text(40, 720, '3').attr({'font': '18px Consolas', 'text-anchor': 'middle', 'font-weight': 'bold', 'fill': '#fff'})
            r.g.text(60, 720, 'Your risk').attr({'font-size': '18px', 'font-weight': 'bold'})
            r.g.text(60+60+10, 720, 'You show an elevated risk of cardiovascular disease')
              .attr({'font-size': '18px', 'font-weight': 'normal', 'fill': '#888'})
            r.g.text(60, 780, 'If you\'re a smoker with normal blood\n pressure, (130 mm/Hg) but family history\n of heart attack before the age of 60 (one\n or both parents) your risk over 10 years is:')
              .attr({'font-size': '14px', 'font-weight': 'normal', 'fill': '#888'})

            r.g.text(320, 780, score.toPrecision(1)+'%')
              .attr({'font-size': '72px', 'font-weight': 'bold', 'fill': '#6A9C2D', 'font-family': "Consolas, monospace", 'font-weight': '900'})

            y = 750;
            r.g.text(460, y, 'Your risk would be lowered to:').attr({'font-size': '14px', 'font-weight': 'bold', 'fill': '#555'})
    
            r.g.text(460, y+16, 'x%').attr({'font-size': '14px', 'font-weight': 'bold', 'fill': '#555'})
            r.g.text(460+28, y+16, 'if your blood pressure were 120mm/Hg').attr({'font-size': '14px', 'fill': '#888'})
            
            r.g.text(460, y+32, 'x%').attr({'font-size': '14px', 'font-weight': 'bold', 'fill': '#555'})
            r.g.text(460+28, y+32, 'if you quit smoking').attr({'font-size': '14px', 'fill': '#888'})

            r.g.text(460, y+48, 'x%').attr({'font-size': '14px', 'font-weight': 'bold', 'fill': '#555'})
            r.g.text(460+28, y+48, 'if you reduced cholesterol to 160mm/DL').attr({'font-size': '14px', 'fill': '#888'})

            r.g.text(60, y+80, 'Use your CRP results and cholesterol level to calculate your 10 year risk of a cardiovascular event at ReynoldsRisk.org')
              .attr({'font-size': '14px', 'font-weight': 'normal', 'fill': '#888'})

            r.path("M10 855 L790 855").attr({'stroke-dasharray': '.', 'stroke-linecap': 'butt'})        
            r.circle(40, 880, 14).attr({'fill': '#F4804E', 'stroke': 'none'});
            r.g.text(40, 880, '4').attr({'font': '18px Consolas', 'text-anchor': 'middle', 'font-weight': 'bold', 'fill': '#fff'})
            r.g.text(60, 880, 'What now?').attr({'font-size': '18px', 'font-weight': 'bold'})
 
            // 780px into 4 col grid. each col 180 + 15 right margin

            y = 900
            x = 30
            r.image("images/runner.png", x,     y, 45, 60);
            r.g.text(x+55, y+12, 'Diet and exercise').attr({'font-size': '14px', 'font-weight': 'bold', 'fill': '#555'})
            r.g.text(x+55, y+36, 'can improve your\ncholesterol levels').attr({'font-size': '14px', 'fill': '#888'})

            r.image("images/smoker.png", x+180, y, 45, 60);
            r.g.text(x+180+55, y+12, 'Quiting smoking').attr({'font-size': '14px', 'font-weight': 'bold', 'fill': '#555'})
            r.g.text(x+180+55, y+36+8, 'can decrease your\nheart disease risk\nby 50% or more').attr({'font-size': '14px', 'fill': '#888'})

            r.image("images/doctor.png", x+360, y, 45, 60);
            r.g.text(x+360+55, y+12, 'Ask your doctor').attr({'font-size': '14px', 'font-weight': 'bold', 'fill': '#555'})
            r.g.text(x+360+55, y+36+8, 'about statins or other\nmedications that can\nlower cholesterol').attr({'font-size': '14px', 'fill': '#888'})

            r.image("images/needle.png", x+540, y, 45, 60);
            r.g.text(x+540+55, y+12, 'Consider retesting').attr({'font-size': '14px', 'font-weight': 'bold', 'fill': '#555'})
            r.g.text(x+540+55, y+36+8, 'in 1 or 2 weeks to\nexclude a temporary\nspike in blood levels').attr({'font-size': '14px', 'fill': '#888'})


            r.path("M10 980 L790 980").attr({'stroke-dasharray': '.', 'stroke-linecap': 'butt'})        
            r.g.text(150, 1000, 'David McCandless & Stefanie Posavec for Wired Magazine // informationisbeautiful.net').attr({'font-size': '14px', 'fill': '#aaa'})
          });
        });
    </script>
  </head>
  <body>
    <div id='holder' style='width: 800px; height: 1200px;'></div>
    <div id='log'></div>
  </body>
</html>
